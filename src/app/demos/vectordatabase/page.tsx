'use client'

import React, { useState, useCallback } from 'react';
import { Container } from '@/components/Container'

const generateNamespace = () => {
  const characters = 'abcdefghijklmnopqrstuvwxyz';
  let namespace = '';
  for (let i = 0; i < 10; i++) {
    namespace += characters.charAt(Math.floor(Math.random() * characters.length));
  }
  return `${namespace}-${String(new Date().getTime())}`;
}

interface Section {
  title: string;
  content: (props?: any) => React.ReactNode;
}

type DemoPhrase = {
  text: string;
  vectors: number[];
  selected: boolean;
}

const Demo = () => {
  const [expandedSection, setExpandedSection] = useState(0);
  const [indexName] = useState('vector-database-demo');
  const [namespace] = useState(generateNamespace());
  const [metadata, setMetadata] = useState<{ [key: string]: string }>({});
  const [upsertingVectors, setUpsertingVectors] = useState(false);
  const [performingQuery, setPerformingQuery] = useState(false);
  const [embeddingProgress, setEmbeddingProgress] = useState(0);
  const [embeddingsGenerated, setEmbeddingsGenerated] = useState(false);
  const [phrases, setPhrases] = useState<DemoPhrase[]>([{
    text: 'The quick brown fox jumps over the lazy dog',
    selected: false,
    vectors: [
      0.03772934526205063,
      0.09122350811958313,
      0.04250900074839592,
      0.07494039088487625,
      0.06442898511886597,
      -0.018219146877527237,
      0.01613166742026806,
      -0.030598215758800507,
      -0.014245708473026752,
      0.020501621067523956,
      0.04402870312333107,
      0.03762723132967949,
      -0.026770127937197685,
      -0.016094138845801353,
      -0.016804685816168785,
      -0.03464184328913689,
      -0.057408273220062256,
      -0.011333649978041649,
      0.03212514892220497,
      -0.05077722668647766,
      -0.08396504074335098,
      -0.034489672631025314,
      0.030174093320965767,
      0.032058171927928925,
      -0.05738786607980728,
      -0.012039026245474815,
      -0.0717071145772934,
      -0.035447992384433746,
      0.07967527210712433,
      -0.10653188824653625,
      -0.017509743571281433,
      0.025871705263853073,
      -0.005158864427357912,
      0.014425919391214848,
      -0.039082422852516174,
      -0.08631822466850281,
      0.07733239233493805,
      -0.014331024140119553,
      0.03383868932723999,
      0.030656006187200546,
      0.02817893773317337,
      -0.02815471775829792,
      -0.056637901812791824,
      0.033300597220659256,
      -0.09356305003166199,
      0.045973896980285645,
      -0.07635755091905594,
      -0.02871989645063877,
      0.018624523654580116,
      0.023899471387267113,
      -0.03282541781663895,
      -0.00023887040151748806,
      0.008056024089455605,
      0.04083418473601341,
      0.06547798216342926,
      -0.0002943791332654655,
      -0.0032664285972714424,
      -0.03245631605386734,
      0.04033869132399559,
      0.004569289740175009,
      0.01927378587424755,
      0.022131212055683136,
      0.025814780965447426,
      0.0060178302228450775,
      0.05662182718515396,
      0.008847580291330814,
      -0.02795732580125332,
      -0.10164234042167664,
      -0.09427206963300705,
      0.01622341386973858,
      0.041995368897914886,
      -0.0567573681473732,
      -0.0088421031832695,
      -0.028629958629608154,
      -0.01783750019967556,
      -0.03029310330748558,
      0.047228701412677765,
      -0.05204819142818451,
      0.06108029559254646,
      0.008272555656731129,
      -0.040044769644737244,
      -0.06884454190731049,
      -0.056968558579683304,
      0.06137960031628609,
      0.04268886521458626,
      0.012585428543388844,
      0.03643461689352989,
      0.03329179435968399,
      -0.023499639704823494,
      -0.02857767976820469,
      -0.019383519887924194,
      -0.05104660987854004,
      -0.02729003131389618,
      0.0430532805621624,
      0.027445536106824875,
      -0.007271843962371349,
      -0.0034271322656422853,
      -0.041863780468702316,
      -0.06809576600790024,
      0.0373217798769474,
      0.02563534490764141,
      0.023445894941687584,
      0.09550252556800842,
      0.009680761955678463,
      -0.00020832470909226686,
      -0.04118230938911438,
      0.003161222441121936,
      0.002427180064842105,
      0.11056726425886154,
      0.03468586131930351,
      -0.007008862216025591,
      0.008482021279633045,
      0.015389113686978817,
      0.11289786547422409,
      0.031307123601436615,
      -0.0027797354850918055,
      -0.07040523737668991,
      -0.038439925760030746,
      -0.03778727725148201,
      -0.09008409082889557,
      0.07130716741085052,
      0.12963436543941498,
      -0.08859200775623322,
      0.012077845633029938,
      -0.023258164525032043,
      -0.05402781069278717,
      -0.01292665209621191,
      -1.9977293230064535e-33,
      0.0853729173541069,
      -0.03316441550850868,
      -0.08366584032773972,
      -0.07513125240802765,
      -0.038649607449769974,
      -0.06656233966350555,
      -0.01953991875052452,
      -0.013501521199941635,
      -0.033019740134477615,
      0.04201265797019005,
      -0.05645839869976044,
      -0.014702326618134975,
      0.005841499660164118,
      -0.04967181384563446,
      -0.022883456200361252,
      -0.06860632449388504,
      -0.006629088427871466,
      -0.014258001931011677,
      0.03205760568380356,
      0.06045692414045334,
      0.029051322489976883,
      0.10319513082504272,
      -0.03279856964945793,
      -0.013972830027341843,
      0.047798775136470795,
      0.0003402242437005043,
      -0.0756005197763443,
      -0.02114364691078663,
      0.0000294812361971708,
      0.05263402312994003,
      -0.05702435225248337,
      -0.06444454193115234,
      -0.013268871232867241,
      0.10165335237979889,
      -0.026316078379750252,
      -0.12819182872772217,
      0.08506378531455994,
      -0.06375286728143692,
      -0.061349328607320786,
      0.056968241930007935,
      -0.002857111394405365,
      0.026756351813673973,
      0.056763965636491776,
      0.014566508121788502,
      -0.07993249595165253,
      -0.0041845510713756084,
      -0.01233028806746006,
      0.025803476572036743,
      0.005689083598554134,
      0.018332678824663162,
      -0.02914855070412159,
      0.02765914611518383,
      0.08487633615732193,
      -0.04711742699146271,
      -0.05451110005378723,
      0.10338509827852249,
      0.07087717205286026,
      -0.005806937348097563,
      -0.03466394171118736,
      0.11306466907262802,
      0.019970513880252838,
      -0.005941590294241905,
      0.0076497625559568405,
      -0.03077472746372223,
      0.10844996571540833,
      -0.0928211361169815,
      -0.07341716438531876,
      -0.007182767149060965,
      -0.03666328266263008,
      0.05376352369785309,
      -0.0006459387950599194,
      0.03631598502397537,
      0.016295189037919044,
      -0.14971251785755157,
      0.026637276634573936,
      -0.02882600575685501,
      -0.004877470433712006,
      -0.03726762533187866,
      0.023066256195306778,
      -0.03644372895359993,
      0.14874860644340515,
      -0.06467793136835098,
      -0.03858637437224388,
      0.038378290832042694,
      -0.026713548228144646,
      0.06685817241668701,
      0.006739569362252951,
      -0.004543544724583626,
      -0.016217388212680817,
      -0.03945444896817207,
      -0.03732758387923241,
      0.0001122451139963232,
      0.04851467162370682,
      -0.0759267508983612,
      0.05840503051877022,
      1.1939659588485135e-33,
      0.05783059448003769,
      -0.027753720059990883,
      0.06222550943493843,
      0.07014906406402588,
      -0.01651415228843689,
      0.02917468547821045,
      -0.037319403141736984,
      0.014038321562111378,
      -0.08193091303110123,
      0.0332721509039402,
      -0.0003003274032380432,
      -0.00884069874882698,
      -0.012019742280244827,
      -0.00018686310795601457,
      0.10306753218173981,
      -0.0051507726311683655,
      0.059810373932123184,
      0.003038766561076045,
      0.017793815582990646,
      0.022732790559530258,
      -0.03478477895259857,
      0.01336541399359703,
      -0.023722659796476364,
      0.08246656507253647,
      0.023229354992508888,
      0.0703963190317154,
      0.09655024856328964,
      -0.022593636065721512,
      -0.03489859402179718,
      -0.10648337751626968,
      -0.019309639930725098,
      -0.06425312161445618,
      -0.01471500750631094,
      -0.0207798071205616,
      0.029262211173772812,
      0.06627011299133301,
      -0.03784902021288872,
      0.01626702770590782,
      -0.02453499846160412,
      -0.09419386088848114,
      0.03406495600938797,
      0.014000716619193554,
      0.004243409726768732,
      0.06547126919031143,
      0.021769315004348755,
      -0.009864907711744308,
      -0.05846000835299492,
      0.04100577533245087,
      -0.032683029770851135,
      0.05501333251595497,
      -0.027609216049313545,
      0.02905118279159069,
      0.05385742336511612,
      0.017946012318134308,
      -0.04484569653868675,
      -0.0742521733045578,
      0.01902230642735958,
      -0.038848429918289185,
      0.039631303399801254,
      -0.01726546138525009,
      -0.0304697435349226,
      0.017088593915104866,
      -0.003149653086438775,
      0.0073785665445029736,
      -0.006833093240857124,
      -0.08578591048717499,
      -0.0707876980304718,
      -0.04290000721812248,
      0.0584416463971138,
      -0.0787840485572815,
      -0.00016181623504962772,
      0.05904122814536095,
      0.010096251964569092,
      -0.04663944989442825,
      0.008754231035709381,
      0.10100074857473373,
      0.07427167147397995,
      0.03404275327920914,
      0.06049822270870209,
      -0.028908798471093178,
      0.002498579677194357,
      -0.029179364442825317,
      -0.01547276321798563,
      0.002466054167598486,
      -0.05100161209702492,
      0.04036112502217293,
      -0.09825393557548523,
      0.054862312972545624,
      0.03141416981816292,
      -0.07200133055448532,
      0.02705365978181362,
      0.08365251868963242,
      0.06293604522943497,
      0.10612515360116959,
      -0.017478028312325478,
      -1.7650890526965668e-8,
      -0.07781007140874863,
      0.03189745172858238,
      -0.11747836321592331,
      0.04831162095069885,
      0.07823401689529419,
      0.028697121888399124,
      -0.027994642034173012,
      0.010166054591536522,
      0.08181684464216232,
      -0.015036921948194504,
      -0.011054870672523975,
      0.03131077066063881,
      0.06684176623821259,
      0.06149473041296005,
      -0.030161865055561066,
      0.0038407815154641867,
      -0.04204786568880081,
      -0.010737108998000622,
      0.032394614070653915,
      0.16522206366062164,
      0.0036203996278345585,
      -0.04770941287279129,
      -0.03821014240384102,
      -0.032638248056173325,
      -0.0340341180562973,
      -0.024107856675982475,
      -0.10704044252634048,
      0.014730701223015785,
      -0.025049302726984024,
      0.019525961950421333,
      -0.051523301750421524,
      0.0887317806482315,
      -0.12752147018909454,
      0.002882324857637286,
      0.018653329461812973,
      0.019110724329948425,
      0.11766166985034943,
      -0.005288416054099798,
      0.03643493726849556,
      -0.0010558495996519923,
      0.015054462477564812,
      0.049896832555532455,
      -0.0057575879618525505,
      -0.015640147030353546,
      -0.049644190818071365,
      -0.003259012009948492,
      -0.04892391338944435,
      -0.09501535445451736,
      0.07044851779937744,
      -0.048959095031023026,
      -0.026588503271341324,
      -0.04014130309224129,
      0.028613844886422157,
      0.060923147946596146,
      -0.029594585299491882,
      -0.02394931949675083,
      0.0029522280674427748,
      -0.06378552317619324,
      -0.049568261951208115,
      0.02819981426000595,
      0.042963799089193344,
      0.05415729060769081,
      0.044828347861766815,
      0.07580341398715973
    ]
  },
  {
    text: 'To be or not to be, that is the question',
    selected: false,
    vectors: [
      0.0487205870449543,
      0.0534062497317791,
      -0.017604077234864235,
      0.026519786566495895,
      -0.012842374853789806,
      0.02899966761469841,
      0.11503759026527405,
      -0.09218104183673859,
      -0.0010423092171549797,
      0.0349685400724411,
      -0.007655231282114983,
      -0.0811896100640297,
      0.013712422922253609,
      -0.007563312072306871,
      0.038147300481796265,
      -0.02314477227628231,
      0.06247119978070259,
      -0.10048753023147583,
      -0.09922275692224503,
      0.0018798932433128357,
      -0.05854261294007301,
      -0.02980726584792137,
      0.009119786322116852,
      0.007463826797902584,
      -0.05604756250977516,
      -0.024927981197834015,
      0.03214693069458008,
      -0.011899883858859539,
      0.029297802597284317,
      0.0405769981443882,
      -0.052041035145521164,
      -0.016806328669190407,
      -0.0885748490691185,
      0.05416624993085861,
      -0.015498019754886627,
      0.05167007818818092,
      0.08272027969360352,
      -0.0732465386390686,
      0.028826996684074402,
      -0.09160388261079788,
      -0.021146785467863083,
      -0.03502175211906433,
      -0.0035373338032513857,
      -0.05350486561655998,
      -0.011282782070338726,
      -0.0071647437289357185,
      0.07392080128192902,
      -0.009144910611212254,
      -0.026062702760100365,
      -0.06005840748548508,
      -0.04379843920469284,
      -0.030824678018689156,
      -0.06492196023464203,
      -0.01385984942317009,
      0.005434203427284956,
      0.031056402251124382,
      -0.025589214637875557,
      0.009591932408511639,
      0.061199575662612915,
      0.019256316125392914,
      -0.010276460088789463,
      0.013947749510407448,
      0.010630796663463116,
      0.08262880146503448,
      0.03478708118200302,
      0.018223034217953682,
      -0.019172366708517075,
      -0.007428060285747051,
      -0.027666814625263214,
      -0.01742464490234852,
      -0.002138264710083604,
      -0.028432616963982582,
      0.007196679711341858,
      0.014261952601373196,
      0.0057843467220664024,
      -0.06212574616074562,
      0.05354901775717735,
      -0.09327249228954315,
      -0.0023837811313569546,
      0.02909812703728676,
      0.016730157658457756,
      -0.05831648036837578,
      -0.0037115137092769146,
      0.014554581604897976,
      -0.03714551776647568,
      -0.030008917674422264,
      0.005500195547938347,
      -0.0235582385212183,
      -0.010236771777272224,
      0.012215597555041313,
      0.013456431217491627,
      0.036380618810653687,
      0.028992876410484314,
      0.020748399198055267,
      -0.0032900229562073946,
      0.039545804262161255,
      -0.06461820751428604,
      -0.014715762808918953,
      -0.03768467158079147,
      0.12380702048540115,
      -0.011755538173019886,
      0.01104553509503603,
      0.001177026191726327,
      -0.0034419235307723284,
      -0.0529448576271534,
      -0.03209076449275017,
      0.07415489107370377,
      0.07269470393657684,
      0.0018483095336705446,
      -0.02645767666399479,
      -0.036076053977012634,
      -0.03488212451338768,
      0.05493391305208206,
      -0.004449015483260155,
      0.04167258366942406,
      0.05077259987592697,
      0.013251575641334057,
      0.05314268916845322,
      0.02747247740626335,
      0.01739952340722084,
      0.02902468480169773,
      0.06703631579875946,
      0.034241050481796265,
      0.03160849213600159,
      -0.006111510097980499,
      -0.08683481067419052,
      0.027502458542585373,
      -4.7357890289226146e-33,
      0.045946262776851654,
      0.030293483287096024,
      0.03543137386441231,
      -0.0063895354978740215,
      -0.10343243926763535,
      0.02433006651699543,
      0.0563909187912941,
      -0.04090433195233345,
      -0.0011711589759215713,
      -0.028179941698908806,
      -0.0270517710596323,
      -0.052158236503601074,
      -0.038778625428676605,
      -0.023984361439943314,
      0.10619308054447174,
      0.012759269215166569,
      -0.04090500995516777,
      0.02028750069439411,
      -0.042741142213344574,
      0.02283610589802265,
      -0.03718555346131325,
      -0.027204809710383415,
      -0.03912871330976486,
      -0.024688081815838814,
      -0.007382404524832964,
      -0.027715357020497322,
      -0.04051820561289787,
      -0.030949562788009644,
      0.025996828451752663,
      -0.003546962747350335,
      -0.026103835552930832,
      0.04933592304587364,
      0.014262828044593334,
      0.0025470545515418053,
      -0.047549400478601456,
      -0.0716286152601242,
      -0.02377287857234478,
      0.0000744425633456558,
      0.001563714467920363,
      -0.09225018322467804,
      0.07305566221475601,
      0.014223512262105942,
      0.0530712716281414,
      -0.02161533571779728,
      0.030911216512322426,
      0.08971495926380157,
      0.08718380331993103,
      0.012739352881908417,
      -0.13901548087596893,
      0.02011740952730179,
      0.06510410457849503,
      -0.011917822994291782,
      0.1404181569814682,
      -0.014011649414896965,
      0.01610030233860016,
      -0.05136575549840927,
      0.032018959522247314,
      0.058623384684324265,
      0.06513935327529907,
      -0.04795878008008003,
      -0.0092226667329669,
      0.04381069913506508,
      0.02268538624048233,
      0.019367936998605728,
      -0.07026242464780807,
      -0.03640062361955643,
      0.03792872279882431,
      0.002382969716563821,
      0.07709100842475891,
      -0.09046231210231781,
      -0.021066568791866302,
      0.002958622295409441,
      -0.04372064024209976,
      0.10249724239110947,
      -0.03786588832736015,
      0.0030794809572398663,
      -0.04065722972154617,
      0.03525211289525032,
      -0.023121923208236694,
      -0.03791728615760803,
      -0.00016012835840228945,
      0.10240985453128815,
      -0.04478396847844124,
      0.057513926178216934,
      0.0373455286026001,
      -0.04633556306362152,
      0.022997690364718437,
      -0.06414057314395905,
      -0.001515720272436738,
      0.14414618909358978,
      0.0620393380522728,
      0.025803832337260246,
      0.02883647195994854,
      -0.06743856519460678,
      -0.03613411262631416,
      2.048082174536903e-33,
      -0.03320089727640152,
      0.04122602194547653,
      -0.04643737152218819,
      0.009403123520314693,
      -0.04229937121272087,
      0.009534559212625027,
      0.03407047688961029,
      -0.02801339328289032,
      -0.016428662464022636,
      0.00479453569278121,
      -0.010039720684289932,
      -0.055217113345861435,
      0.05777582898736,
      -0.024352028965950012,
      -0.04380054026842117,
      0.0025446992367506027,
      0.06779596209526062,
      -0.00129168841522187,
      -0.05172111839056015,
      -0.02507668547332287,
      -0.04960321635007858,
      0.08637619763612747,
      -0.08672113716602325,
      0.08511484414339066,
      -0.09641240537166595,
      0.057450756430625916,
      -0.00841431599110365,
      -0.054757338017225266,
      -0.02625960484147072,
      0.04126419872045517,
      0.003328894032165408,
      0.032165318727493286,
      -0.04711059480905533,
      -0.050179533660411835,
      0.006820464972406626,
      0.06495125591754913,
      0.05216784030199051,
      0.07698868960142136,
      -0.07895414531230927,
      0.05724301189184189,
      -0.045485205948352814,
      0.021357009187340736,
      -0.1287253201007843,
      0.07816579192876816,
      -0.014608822762966156,
      -0.06505467742681503,
      0.11836715042591095,
      0.02811811864376068,
      0.055909413844347,
      0.05428667739033699,
      -0.1615101397037506,
      -0.02024783194065094,
      -0.0032874764874577522,
      0.02389528974890709,
      0.03624569997191429,
      0.023341957479715347,
      -0.04946068301796913,
      -0.07657506316900253,
      0.04145520180463791,
      0.007822155021131039,
      0.035271987318992615,
      -0.052581630647182465,
      0.05015254020690918,
      -0.01415577158331871,
      0.0009655800531618297,
      -0.003236854914575815,
      -0.054042719304561615,
      0.10760068893432617,
      -0.0028610273730009794,
      0.000005889126441616099,
      -0.046735458076000214,
      -0.13046836853027344,
      -0.00839059054851532,
      0.04722953215241432,
      -0.10928042978048325,
      -0.07297822833061218,
      0.04090608283877373,
      -0.02790094166994095,
      0.0009517137659713626,
      -0.14451777935028076,
      0.016116227954626083,
      -0.01284544076770544,
      -0.005645174998790026,
      0.053519751876592636,
      -0.05674730986356735,
      -0.050306811928749084,
      0.03988541662693024,
      0.03745922073721886,
      0.089405857026577,
      -0.027692371979355812,
      -0.011528084985911846,
      -0.0239242035895586,
      -0.06996165215969086,
      0.013556287623941898,
      -0.00883677788078785,
      -2.5147802062974733e-8,
      0.03154405951499939,
      0.01237318105995655,
      -0.05720166862010956,
      -0.02804562635719776,
      -0.02803301066160202,
      0.06724578887224197,
      0.09873127192258835,
      -0.13315168023109436,
      0.0024614876601845026,
      0.0752919390797615,
      0.027254758402705193,
      -0.024952467530965805,
      -0.07223144173622131,
      0.03215598315000534,
      0.01708940975368023,
      -0.014810440130531788,
      0.01007218100130558,
      -0.09664441645145416,
      -0.07139068096876144,
      0.06892331689596176,
      0.00915239192545414,
      -0.012299961410462856,
      -0.09057965874671936,
      -0.013071807101368904,
      0.029917201027274132,
      -0.009795366786420345,
      0.05811506137251854,
      0.03063255548477173,
      0.022991731762886047,
      0.07220347225666046,
      0.07031702995300293,
      0.024459604173898697,
      -0.011346825398504734,
      0.006959450431168079,
      -0.036438338458538055,
      -0.04950929433107376,
      0.0014508432941511273,
      0.04756747558712959,
      -0.0325612872838974,
      0.01562619023025036,
      0.07147207856178284,
      0.07987574487924576,
      -0.0028402225580066442,
      0.14817267656326294,
      -0.027127714827656746,
      0.04496905952692032,
      0.009483364410698414,
      -0.007698942441493273,
      -0.07676170766353607,
      -0.05000859126448631,
      -0.03989804536104202,
      -0.10165277123451233,
      0.014960046857595444,
      0.02697116509079933,
      0.03290370851755142,
      0.00816859770566225,
      -0.030993623659014702,
      0.12676618993282318,
      -0.10628169775009155,
      0.029089830815792084,
      0.08780818432569504,
      -0.01273160707205534,
      0.05755211040377617,
      -0.0058928667567670345
    ]
  },
  {
    text: 'A picture is worth a thousand words',
    selected: false,
    vectors: [
      -0.008375367149710655,
      0.06138879805803299,
      -0.021502384915947914,
      0.00020995011436752975,
      -0.028242316097021103,
      -0.004693206399679184,
      0.05545693263411522,
      0.020880265161395073,
      -0.0006022070301696658,
      0.025594351813197136,
      0.024221519008278847,
      -0.006672119256108999,
      0.10146141797304153,
      0.06244349107146263,
      -0.08559663593769073,
      0.01984868384897709,
      0.07531838864088058,
      -0.03225921094417572,
      -0.05264785513281822,
      -0.0526072159409523,
      -0.0025142827071249485,
      0.03419456258416176,
      0.023227714002132416,
      -0.00811470951884985,
      -0.012060909532010555,
      0.05355942249298096,
      -0.04822825267910957,
      -0.010416102595627308,
      0.029033074155449867,
      0.0025151241570711136,
      -0.006697406526654959,
      0.0794687420129776,
      0.04754999279975891,
      0.1019580140709877,
      -0.012128230184316635,
      0.042531657963991165,
      -0.006301144137978554,
      -0.0037622228264808655,
      0.03424300253391266,
      -0.004426900763064623,
      0.011603963561356068,
      -0.09081943333148956,
      0.03396949917078018,
      0.04529562219977379,
      0.07962040603160858,
      0.04238540679216385,
      -0.08463916927576065,
      -0.01486153807491064,
      0.017395617440342903,
      -0.03803861886262894,
      -0.06820201873779297,
      -0.08757790178060532,
      -0.054017167538404465,
      -0.044037993997335434,
      0.022332007065415382,
      0.004098676610738039,
      0.04965656250715256,
      -0.05205407738685608,
      -0.041893940418958664,
      -0.010412242263555527,
      0.06935924291610718,
      -0.005487297661602497,
      -0.0344817079603672,
      0.015216409228742123,
      0.0875304713845253,
      -0.0399031825363636,
      -0.03554418310523033,
      -0.039315465837717056,
      -0.07399295270442963,
      -0.02193429321050644,
      0.01713801734149456,
      0.07724133133888245,
      0.007276594173163176,
      0.02746974118053913,
      -0.0064099510200321674,
      -0.056101541966199875,
      0.04643138125538826,
      -0.043547216802835464,
      0.027104031294584274,
      -0.04692849889397621,
      -0.023487722501158714,
      -0.031688857823610306,
      -0.005243164487183094,
      -0.02754274569451809,
      -0.05113784968852997,
      -0.014375572092831135,
      0.018508795648813248,
      -0.10136984288692474,
      -0.07950373739004135,
      -0.04691407456994057,
      -0.057944077998399734,
      -0.06871851533651352,
      -0.011260397732257843,
      -0.00669885566458106,
      0.00513714924454689,
      0.032141391187906265,
      -0.048929959535598755,
      -0.018303925171494484,
      -0.03920707106590271,
      0.06901667267084122,
      0.02093958482146263,
      -0.02591528557240963,
      0.042557209730148315,
      -0.008058802224695683,
      0.0040589612908661366,
      -0.053887467831373215,
      -0.012647995725274086,
      0.11015120148658752,
      -0.018814895302057266,
      -0.035158973187208176,
      -0.032311663031578064,
      -0.02119334228336811,
      -0.02640952542424202,
      0.09338889271020889,
      0.0034722823183983564,
      -0.050654977560043335,
      -0.01774817705154419,
      -0.037331391125917435,
      0.022478513419628143,
      -0.08231455087661743,
      0.03828404098749161,
      -0.02309621311724186,
      0.031824421137571335,
      0.0635877326130867,
      -0.09270109236240387,
      -0.08635507524013519,
      0.030464094132184982,
      -5.811662437564621e-33,
      0.04004794359207153,
      0.03202243521809578,
      0.04309007525444031,
      0.11588776111602783,
      0.06593531370162964,
      0.00024972541723400354,
      0.011573041789233685,
      0.006099367514252663,
      -0.010311443358659744,
      0.0276710893958807,
      0.020880836993455887,
      0.05430109426379204,
      0.016764553263783455,
      0.0913316085934639,
      0.05364315211772919,
      -0.08289195597171783,
      -0.025110796093940735,
      -0.010464228689670563,
      0.02412405237555504,
      0.03424595668911934,
      -0.039614126086235046,
      -0.04042601212859154,
      0.016038089990615845,
      -0.027158472687005997,
      -0.021869046613574028,
      0.09518643468618393,
      0.02164262719452381,
      -0.04629981890320778,
      0.03532889857888222,
      0.04564528912305832,
      0.047653160989284515,
      0.02955779992043972,
      0.0666176900267601,
      -0.03474346548318863,
      0.011038372293114662,
      -0.04152301326394081,
      0.0026774927973747253,
      -0.10881604999303818,
      0.01520611997693777,
      0.023912232369184494,
      -0.09002863615751266,
      -0.011887075379490852,
      -0.03962850570678711,
      -0.024165410548448563,
      0.02381543442606926,
      0.1043248251080513,
      -0.03784916549921036,
      0.0847904160618782,
      -0.03046591393649578,
      0.012075728736817837,
      0.06963655352592468,
      0.036334265023469925,
      -0.04509250819683075,
      -0.03265618905425072,
      -0.05232088640332222,
      -0.004971302580088377,
      0.027536306530237198,
      0.022845640778541565,
      -0.020730359479784966,
      -0.01330338604748249,
      0.03569858893752098,
      0.11750279366970062,
      -0.0026236306875944138,
      0.08743619918823242,
      0.011788764968514442,
      0.05961725860834122,
      -0.05175667256116867,
      0.04369485750794411,
      0.015469682402908802,
      -0.0029443015810102224,
      -0.06672139465808868,
      -0.021672997623682022,
      0.08001063019037247,
      -0.055620383471250534,
      -0.007902564480900764,
      -0.000958599615842104,
      0.08131329715251923,
      -0.039761561900377274,
      -0.08481955528259277,
      0.14142060279846191,
      -0.04394068941473961,
      -0.06306959688663483,
      0.02685302123427391,
      -0.07111240178346634,
      -0.028006231412291527,
      -0.03947780653834343,
      0.04385834559798241,
      -0.08809606730937958,
      0.06003763899207115,
      0.003900805488228798,
      -0.029413167387247086,
      0.06380104273557663,
      0.08963283896446228,
      -0.1268932968378067,
      -0.07602031528949738,
      3.922330407764283e-33,
      0.014605028554797173,
      0.01814216934144497,
      -0.030078820884227753,
      0.09191597253084183,
      0.021151909604668617,
      -0.005809958092868328,
      -0.0049351234920322895,
      0.13746333122253418,
      -0.044953860342502594,
      0.043032966554164886,
      -0.010389131493866444,
      0.04763404279947281,
      -0.028272245079278946,
      0.01813388057053089,
      0.053168948739767075,
      -0.06013878062367439,
      0.08631864935159683,
      0.006253963336348534,
      -0.0699910894036293,
      0.054621387273073196,
      -0.05724434554576874,
      0.08118221163749695,
      0.039074793457984924,
      0.03268338367342949,
      -0.038862116634845734,
      0.11022412776947021,
      0.0010470598936080933,
      -0.09202989190816879,
      -0.03683210536837578,
      0.007883352227509022,
      -0.01687265932559967,
      -0.07580738514661789,
      -0.02310336008667946,
      0.004519850015640259,
      -0.10096650570631027,
      0.03501581773161888,
      0.14485163986682892,
      -0.07568050920963287,
      -0.08422324061393738,
      0.0170102771371603,
      0.06564953923225403,
      0.003940528724342585,
      0.011636195704340935,
      0.03427322208881378,
      -0.0327531099319458,
      -0.0803348645567894,
      -0.08151067048311234,
      -0.0020763264037668705,
      0.07016291469335556,
      0.08104941993951797,
      0.04199283942580223,
      0.03649478778243065,
      0.0434073805809021,
      0.04652971029281616,
      -0.0030405912548303604,
      -0.08823762834072113,
      -0.060746390372514725,
      -0.010468093678355217,
      0.029998717829585075,
      0.005653083324432373,
      -0.026894347742199898,
      -0.008626443333923817,
      -0.05080720782279968,
      0.08181875944137573,
      0.05019611120223999,
      -0.043702658265829086,
      -0.11650322377681732,
      -0.02411971054971218,
      -0.059986330568790436,
      -0.015221557579934597,
      0.0033340672962367535,
      0.008671099320054054,
      -0.04711870849132538,
      -0.006859871093183756,
      0.026149015873670578,
      -0.016235297545790672,
      -0.010287049226462841,
      -0.011775716207921505,
      0.014333783648908138,
      -0.047115981578826904,
      -0.006951075047254562,
      -0.0572657585144043,
      0.02976859360933304,
      0.062337081879377365,
      0.03200671076774597,
      0.0759468749165535,
      -0.0834469348192215,
      0.02594224363565445,
      0.04579712077975273,
      -0.020794864743947983,
      -0.05436704680323601,
      0.0109077338129282,
      0.007515887264162302,
      -0.08879033476114273,
      0.061364054679870605,
      -2.064639303966942e-8,
      -0.02488400787115097,
      0.0006923145265318453,
      0.028402341529726982,
      -0.08713407069444656,
      0.03570150211453438,
      -0.01228381134569645,
      0.019992107525467873,
      -0.026569563895463943,
      -0.06066088005900383,
      -0.007959071546792984,
      0.1336459517478943,
      -0.00694746058434248,
      -0.11542399972677231,
      0.0458039790391922,
      0.01932540535926819,
      0.0122222313657403,
      -0.019096767529845238,
      0.008363691158592701,
      0.0044095516204833984,
      0.034518543630838394,
      -0.05793919786810875,
      0.000043925378122366965,
      0.05362626537680626,
      0.0033263645600527525,
      -0.032118771225214005,
      0.008755506947636604,
      -0.05150708183646202,
      0.09445293247699738,
      0.0007572370232082903,
      -0.019599732011556625,
      0.006306150928139687,
      -0.0053586713038384914,
      -0.058314211666584015,
      -0.013676723465323448,
      0.09427657723426819,
      -0.011090894229710102,
      -0.04215412959456444,
      -0.013921738602221012,
      0.021367836743593216,
      -0.039726901799440384,
      -0.03022240288555622,
      -0.02497068978846073,
      0.014785373583436012,
      0.14397557079792023,
      0.09404382109642029,
      0.00800246186554432,
      0.06207119673490524,
      -0.07473526149988174,
      -0.046476058661937714,
      -0.02418411150574684,
      -0.0101002287119627,
      0.043928127735853195,
      0.06377558410167694,
      0.03438866510987282,
      -0.020180217921733856,
      -0.12419528514146805,
      0.03163878992199898,
      0.02740585058927536,
      0.029628021642565727,
      0.07096905261278152,
      -0.0035208931658416986,
      -0.022230809554457664,
      -0.06850443035364151,
      0.0066793495789170265
    ]
  }]);

  const handleSectionCompletion = (sectionIndex: number) => {
    setExpandedSection(sectionIndex);
  };

  const handleSectionToggle = (sectionIndex: number) => {
    if (expandedSection === sectionIndex) {
      setExpandedSection(0);
    } else {
      setExpandedSection(sectionIndex);
    }
  };

  const handleCreateIndex = () => {
    handleSectionCompletion(1);
  }

  const handleCreateNamespace = () => {
    handleSectionCompletion(2);
  }

  const handlePhraseSelection = (phrase: string) => {
    setPhrases(phrases.filter((p) => {
      if (p.text === phrase) {
        p.selected = !p.selected;
      }
    }))
  };

  const handleGenerateEmbeddings = async () => {
    console.log(`handleGenerateEmbeddings`)
    setEmbeddingProgress(0);
    setEmbeddingsGenerated(false);

    for (let i = 0; i < 100; i++) {
      await new Promise((resolve) => setTimeout(resolve, 20));
      setEmbeddingProgress(i + 1);
    }

    setEmbeddingsGenerated(true);
  };

  const handleUpsert = async () => {
    const vectorsToUpsert = phrases
      .filter((phrase) => selectedPhrases.includes(phrase.text))
      .map((phrase) => ({
        vectors: phrase.vectors,
        metadata: metadata,
      }));

    handleUpsertVectors(vectorsToUpsert);
  };

  const handleUpsertVectors = async (vectorsToUpsert: any[]) => {
    console.log(`handleUpsertVectors: ${namespace}`);
    setUpsertingVectors(true);

    try {
      const response = await fetch('/api/pineconenamespaces', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          vectorsToUpsert,
        }),
      });

      if (response.ok) {
        handleSectionCompletion(3);
      } else {
        console.error('Error upserting vectors:', response.statusText);
      }
    } catch (error) {
      console.error('Error upserting vectors:', error);
    } finally {
      setUpsertingVectors(false);
    }
  };

  const [sections] = useState<Section[]>([
    {
      title: 'Step 1: Create an Index',
      content: () => (
        <div className="p-4 text-gray-300">
          <p className="mb-4">
            An index is a data structure that enables efficient search and retrieval of vectors. Normally, you'd create your own index, but for the purposes of this demo,
            the index has already been created. In the next step, we'll create a namespace within this index that is unique to you.
          </p>

          <p className="mb-4 mt-6">
            Vector indexing is a core concept in vector databases. Indexes are a data structure that enable fast retrieval of vectors over large datasets. By creating an index, you can quickly search for similar vectors in the database.
          </p>
          <p className="mb-4 mt-6">You can also use indexes as an organizational tool, by creating a new index for each of your use cases or apps.</p>

          <label className="block mt-4">Demo Index</label>
          <input
            type="text"
            className="border border-gray-300 rounded p-2 mt-4"
            placeholder={indexName}
            disabled={true}
          />

          <button
            className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 ml-4 rounded"
            onClick={handleCreateIndex}
          >
            Got it - proceed to create a namespace
          </button>
        </div>
      ),
    },
    {
      title: 'Step 2: Create a Namespace',
      content: () => (
        <div className="p-4 text-gray-300">
          <p className="mb-4">
            In this section, you will create a new namespace within your index. A namespace is like a partition or divider - it's suitable for organizing vectors by use case or app, and for implementing multi-tenancy,
            where each organization or user gets their own namespace. The namespace you can create for this demo has been pre-populated for you.
          </p>

          <p className="mb-4">
            All of the vectors you upsert in the next step will go into your namespace.
          </p>

          <button
            className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded"
            onClick={handleCreateNamespace}
            disabled={false}
          >
            Create Namespace
          </button>

          <input
            type="text"
            className="border border-gray-300 rounded p-2 mt-4 ml-8"
            placeholder={namespace}
            disabled={true}
          />
        </div>
      ),
    },
    {
      title: 'Step 3: Upsert Vectors and optionally attach Metadata',
      content: () => {
        return (
          <div className="p-4 text-gray-300">
            <p className="mb-4">
              Select phrases below to convert them to vector embeddings. Optionally, add metadata to associate with the vectors.
            </p>
            <div className="space-y-4 mb-6">
              {phrases.map((phrase, index) => (
                <div
                  key={index}
                  className={`border rounded-md p-4 cursor-pointer ${phrase.selected ? 'bg-green-600 text-white' : 'border-gray-700'
                    }`}
                  onClick={() => handlePhraseSelection(phrase.text)}
                >
                  <div className="flex items-center">
                    <span className="ml-2 text-lg">{phrase.text}</span>
                    {(phrase.selected) && (
                      <button
                        className="ml-auto text-white hover:text-red-200 focus:outline-none"
                        onClick={(e) => {
                          e.stopPropagation();
                          handlePhraseSelection(phrase.text);
                        }}
                      >
                        <svg className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path
                            fillRule="evenodd"
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                            clipRule="evenodd"
                          />
                        </svg>
                      </button>
                    )}
                  </div>
                </div>
              ))}
            </div>
            <button
              className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded mb-4"
              onClick={handleGenerateEmbeddings}
              disabled={phrases.filter((phrase) => phrase.selected).length === 0 || embeddingProgress > 0}
            >
              {embeddingProgress > 0 ? 'Generating Embeddings...' : 'Generate Embeddings'}
            </button>
            {
              embeddingProgress > 0 && (
                <div className="mb-4">
                  <div className="relative">
                    <div className="flex items-center justify-center">
                      <svg className="h-32 w-32" viewBox="0 0 100 100">
                        <circle
                          className="text-gray-300"
                          strokeWidth="5"
                          stroke="currentColor"
                          fill="transparent"
                          r="30"
                          cx="50"
                          cy="50"
                        />
                        <circle
                          className="text-blue-600"
                          strokeWidth="5"
                          strokeDasharray={`${embeddingProgress * 1.88}, 188`}
                          strokeDashoffset="0"
                          strokeLinecap="round"
                          stroke="currentColor"
                          fill="transparent"
                          r="30"
                          cx="50"
                          cy="50"
                        />
                      </svg>
                      <div className="absolute inset-0 flex items-center justify-center">
                        <span className="text-blue-600 text-xl font-semibold">{embeddingProgress}%</span>
                      </div>
                    </div>
                    <div className="mt-4 text-center">
                      <span className="text-gray-400">Converting phrases to embeddings...</span>
                    </div>
                  </div>
                </div>
              )
            }
            {
              embeddingsGenerated && (
                <div className="mb-4">
                  <div className="flex items-center justify-center">
                    <svg className="h-32 w-32 text-green-600" viewBox="0 0 20 20" fill="currentColor">
                      <path
                        fillRule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                        clipRule="evenodd"
                      />
                    </svg>
                  </div>
                  <div className="mt-4 text-center">
                    <span className="text-green-600 text-xl font-semibold">Embeddings Generated!</span>
                  </div>
                </div>
              )
            }
            <div className="mb-6">
              <h3 className="text-xl font-semibold mb-2">Metadata (Optional)</h3>
              {/* Metadata input fields */}
              <p className="text-gray-400 mb-2">
                Metadata allows you to associate additional information with your vectors, enabling more precise querying, filtering, and categorization based on specific attributes or properties. By attaching relevant metadata to your vectors, you can enhance the functionality and usefulness of your vector database, making it easier to retrieve and work with specific subsets of vectors that match certain criteria.
              </p>
              <p className="text-gray-400 mb-2">
                You can think of Metadata like a JavaScript object. Experiment with metadata here by entering key-value pairs like `age: 30` or `city: San Francisco`, or `category: shoes`.
              </p>

              <div className="space-y-2">
                {Object.entries(metadata).map(([key, value]) => (
                  key !== 'key' && key !== 'value' && (
                    <div key={key} className="flex items-center mb-2">
                      <input
                        type="text"
                        className="mt-1 block w-1/3 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                        value={key}
                        onChange={(e) => handleMetadataChange(e.target.value, value)}
                      />
                      <span className="mx-2">:</span>
                      <input
                        type="text"
                        className="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                        value={value}
                        onChange={(e) => handleMetadataChange(key, e.target.value)}
                      />
                      <button
                        className="ml-2 text-red-500 hover:text-red-700 text-sm"
                        onClick={() => handleMetadataDelete(key)}
                      >
                        Delete
                      </button>
                    </div>
                  )
                ))}
                <div className="flex items-center">
                  <input
                    type="text"
                    className="mt-1 block w-1/3 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                    placeholder="Key"
                    value={metadata.key || ''}
                    onChange={(e) => handleMetadataChange('key', e.target.value)}
                  />
                  <span className="mx-2">:</span>
                  <input
                    type="text"
                    className="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                    placeholder="Value"
                    value={metadata.value || ''}
                    onChange={(e) => handleMetadataChange('value', e.target.value)}
                  />
                  <button
                    className="ml-2 text-blue-500 hover:text-blue-700 text-sm"
                    onClick={undefined}
                  >
                    Add
                  </button>
                </div>
              </div>
              {Object.keys(metadata).filter((key) => key !== 'key' && key !== 'value').length > 0 && (
                <div className="mt-4">
                  <h4 className="text-lg font-semibold mb-2">Metadata Preview</h4>
                  <pre className="text-sm text-gray-500">
                    {JSON.stringify(
                      Object.entries(metadata)
                        .filter(([key]) => key !== 'key' && key !== 'value')
                        .reduce((obj, [key, value]) => ({ ...obj, [key]: value }), {}),
                      null,
                      2
                    )}
                  </pre>
                </div>
              )}

            </div>
            <button
              className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded"
              onClick={handleUpsert}
              disabled={!embeddingsGenerated}
            >
              Upsert Vectors
            </button>
          </div >
        );
      },
    },
    {
      title: 'Step 4: Perform query',
      content: () => (
        <div className="p-4 text-gray-300">
          <p className="mb-4">
            In this section, you can perform a similarity search on the index. Enter a query phrase
            and find the most similar vectors based on semantic meaning.
          </p>
          {/* Add form or input fields for querying the index */}
          <button
            className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded"
            onClick={() => handleSectionCompletion(4)}
          >
            {performingQuery ? (
              <svg
                className="animate-spin h-5 w-5 mr-3 inline"
                viewBox="0 0 24 24"
              >
                <circle
                  className="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  strokeWidth="4"
                />
                <path
                  className="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                />
              </svg>
            ) : (
              'Search'
            )}
          </button>
        </div>
      ),
    },
    {
      title: 'Step 5: Visualize vector space',
      content: () => (<span></span>),
    },
    {
      title: 'Step 6: Clean Up',
      content: () => (
        <div className="p-4 text-gray-300">
          <p className="mb-4">
            In this section, you can clean up the demo by deleting the namespace you created.
          </p>
          <button
            className="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded"
            onClick={() => handleSectionCompletion(0)}
            disabled={sections[4].loading}
          >
            {sections[4].loading ? (
              <svg
                className="animate-spin h-5 w-5 mr-3 inline"
                viewBox="0 0 24 24"
              >
                <circle
                  className="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  strokeWidth="4"
                />
                <path
                  className="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                />
              </svg>
            ) : (
              'Delete Namespace'
            )}
          </button>
        </div>
      ),
    },
  ]);

  return (
    <Container className="mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8 text-white text-center">Vector Database Demo</h1>
      <p className="text-zinc-200 mb-6">
        This interactive demo helps you get familiar with vector database operations: You can create a namespace, populate it with embeddings, attach metadata
        to your embeddings when upserting them, and then issue queries in order to see what results are retrieved.
      </p>
      <p className="text-zinc-200 mb-6">
        It uses Pinecone under the hood for the vector database provider and is a great introduction to working with
        vector databases.
      </p>
      <div className="bg-gray-800 shadow-md rounded-lg mx-auto">
        {sections.map((section, index) => (
          <div key={index} className="border-b border-gray-700">
            <div
              className={`flex justify-between items-center p-4 cursor-pointer ${expandedSection === index ? 'bg-gray-700' : ''
                }`}
              onClick={() => handleSectionToggle(index)}
            >
              <h3 className="text-lg font-semibold text-white">{section.title}</h3>
              <svg
                className={`w-6 h-6 transform transition-transform text-white ${expandedSection === index ? 'rotate-180' : ''
                  }`}
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
              </svg>
            </div>
            {expandedSection === index && (
              <div>
                {section.content()}
              </div>
            )}
          </div>
        ))}
      </div>
    </Container>
  );
}

export default Demo;
